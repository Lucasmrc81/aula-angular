<app-loading-spinner *ngIf="loading"></app-loading-spinner>

<div *ngIf="!loading">
  <div *ngIf="erro" class="error-text">{{ erro }}</div>

  <div class="characters-container">
    <!-- Grid de cards de personagens -->
    <div class="character-grid">
      <div
        *ngFor="let personagem of personagensVisiveis"
        class="character-card"
        (click)="selectCharacter(personagem)"
      >
        <img
          [src]="personagem.image"
          [alt]="personagem.name"
          class="character-image"
          loading="lazy"
        />
        <h2 class="character-name hover-gradient">
          {{ personagem.name || personagem.nome }}
        </h2>

        <div class="character-info">
          <p class="character-info-row">
            <span class="field-name">Altura</span>
            <span class="field-value">{{ personagem.height }} m</span>
          </p>
          <p class="character-info-row">
            <span class="field-name">Peso</span>
            <span class="field-value">{{ personagem.mass }} kg</span>
          </p>
          <p class="character-info-row">
            <span class="field-name">Status</span>
            <span class="field-value">
              {{ personagem.alive ? "Alive" : "Deceased" }}
            </span>
          </p>
          <!-- âŒ Filmes removidos dos cards -->
        </div>
      </div>
    </div>

    <!-- BotÃ£o "Carregar mais" -->
    <div class="show-more" *ngIf="temMaisPersonagens">
      <button (click)="carregarMais()" [disabled]="loadingMais">
        <span *ngIf="!loadingMais">Carregar mais</span>
        <span *ngIf="loadingMais">Carregando...</span>
      </button>
    </div>

    <!-- Mensagem quando acabar -->
    <p class="end-message" *ngIf="!temMaisPersonagens">
      Todos os personagens foram exibidos.
    </p>
  </div>
</div>

<!-- Painel lateral -->
<div
  class="side-panel-backdrop"
  [class.open]="selectedCharacter"
  (click)="closePanel()"
></div>

<div class="side-panel" [class.open]="selectedCharacter">
  <button class="close-btn" (click)="closePanel()">X</button>

  <!-- Imagem de capa -->
  <img
    [src]="selectedCharacter?.image"
    [alt]="selectedCharacter?.name"
    class="panel-cover"
  />

  <!-- Nome do personagem -->
  <h2 class="panel-title">{{ selectedCharacter?.name }}</h2>

  <div class="panel-info">
    <p class="character-info-row">
      <span class="field-name">Altura</span>
      <span class="field-value">{{ selectedCharacter?.height }} m</span>
    </p>
    <p class="character-info-row">
      <span class="field-name">Peso</span>
      <span class="field-value">{{ selectedCharacter?.mass }} kg</span>
    </p>
    <p class="character-info-row">
      <span class="field-name">GÃªnero</span>
      <span class="field-value">{{ selectedCharacter?.gender }}</span>
    </p>
    <p class="character-info-row">
      <span class="field-name">Planeta</span>
      <span class="field-value">{{ selectedCharacter?.homeworld }}</span>
    </p>
    <p class="character-info-row">
      <span class="field-name">Status</span>
      <span class="field-value">
        {{ selectedCharacter?.alive ? "Alive" : "Deceased" }}
      </span>
    </p>

    <!-- Lista de filmes com Ã­cone ðŸŽ¬ -->
    <p class="character-info-row">
      <span class="field-name">Filmes</span>
      <span class="field-value">
        <ng-container
          *ngIf="selectedCharacter?.filmTitles?.length > 0; else noFilmsPanel"
        >
          <ul>
            <li *ngFor="let filme of selectedCharacter?.filmTitles">
              {{ filme }}
              <span
                class="film-icon"
                (click)="openFilm(filme)"
                title="Ver detalhes do filme"
              >
                ðŸŽ¬
              </span>
            </li>
          </ul>
        </ng-container>
        <ng-template #noFilmsPanel>N/A</ng-template>
      </span>
    </p>

    <p class="character-info-row">
      <span class="field-name">AfiliaÃ§Ãµes</span>
      <span class="field-value">
        {{ selectedCharacter?.affiliations?.join(", ") || "N/A" }}
      </span>
    </p>
    <p class="character-info-row">
      <span class="field-name">Mestres</span>
      <span class="field-value">
        {{ selectedCharacter?.masters?.join(", ") || "N/A" }}
      </span>
    </p>
    <p class="character-info-row">
      <span class="field-name">Aprendizes</span>
      <span class="field-value">
        {{ selectedCharacter?.apprentices?.join(", ") || "N/A" }}
      </span>
    </p>
  </div>
</div>
